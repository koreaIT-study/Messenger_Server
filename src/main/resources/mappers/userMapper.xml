<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 위 코드가 mapper 설정을 하는 코드 -->

<!-- Mapper를 사용하는 Repository의 전체 경로를 적어줘야함. -->
<mapper
	namespace="com.teamride.messenger.server.mapper.UserMapper">
	<select id="getAll" resultType="UserDTO">
		select * from user
	</select>

	<select id="checkExistUser" resultType="Integer">
		select count(*) from
		user
		where email = #{email}
	</select>

	<insert id="saveUser">
		INSERT INTO
		`messenger`.`user`(`email`,`name`,`pwd`,`profile_img`)
		VALUES
		(#{email}, #{name}, #{pwd}, #{profileImg})
	</insert>

	<select id="getUserInfo" resultType="UserDTO">
		select
		*
		from
		user
		where
		email =
		#{email} and pwd = #{pwd}
	</select>
	
	<select id="getUserInfoWithSocial" resultType="UserDTO">
		select
		*
		from
		user
		where
		email =
		#{email}
	</select>

	<select id="getFriendList" resultType="FriendInfoDTO">
		select
		f.friend_id
		, u.email
		,
		u.name
		, ifnull(u.profile_img, '') profile_img
		, ifnull(m.ROOM_ID, '')
		ROOM_ID
		from friend f
		join user u
		on f.friend_id = u.id
		and f.user_id =
		#{userId}
		left join (
		select
		r.room_id
		, m.ID
		from c_room r
		join
		C_ROOM_MEMBER m
		on r.room_id = m.ROOM_ID
		and r.is_group = 'N'
		) m
		on u.id
		= m.ID
	</select>
</mapper>